"use strict";(window["webpackJsonpPluginrune-laenen-two-factor-auth"]=window["webpackJsonpPluginrune-laenen-two-factor-auth"]||[]).push([[635],{635:function(t,n,r){r.r(n),r.d(n,{default:function(){return i}});let{Context:e,Application:s}=Shopware;var i={template:'{% block sw_login_login %}\r\n\r\n    <div v-if="!showOtpForm">\r\n        {% parent %}\r\n    </div>\r\n    <div v-else>\r\n        <form class="sw-login-login sw-login-login-otp" @submit.prevent="loginUserWithPasswordAndOtp">\r\n            <h2 class="sw-login__content-headline">{{ $tc(\'sw-login.index.headlineForm\') }}</h2>\r\n\r\n            <sw-text-field\r\n                v-autofocus\r\n                v-model:value="otp"\r\n                :label="$tc(\'rl-2fa.sw-login.index.labelOtp\')"\r\n                required>\r\n            </sw-text-field>\r\n\r\n            <div class="sw-login__submit">\r\n                <sw-button :disabled="otp.length != 6 || password.length <= 0 || username.length <= 0"\r\n                           class="sw-login__login-action"\r\n                           variant="primary">\r\n                    {{ $tc(\'sw-login.index.buttonLogin\') }}\r\n                </sw-button>\r\n            </div>\r\n        </form>\r\n    </div>\r\n{% endblock %}\r\n',data(){return{rememberOtpPassword:"",showOtpForm:!1,otp:""}},methods:{loginUserWithPasswordAndOtp(){return this.$emit("is-loading"),this.loginWithOtp(this.username,this.password,this.otp).then(()=>{this.handleLoginSuccess(),this.$emit("is-not-loading")}).catch(t=>{this.password="",this.otp="",this.showOtpForm=!1,this.handleLoginError(t),this.$emit("is-not-loading")})},loginWithOtp(t,n,r){return s.getContainer("init").httpClient.post("/oauth/token",{grant_type:"password",client_id:"administration",scopes:"write",username:t,password:n,rl_2fa_otp:r},{baseURL:e.api.apiPath}).then(t=>{let n=this.loginService.setBearerAuthentication({access:t.data.access_token,refresh:t.data.refresh_token,expiry:t.data.expires_in});return window.localStorage.setItem("redirectFromLogin","true"),n})},loginUserWithPassword(){this.rememberOtpPassword=this.password,this.$super("loginUserWithPassword")},handleLoginError(t){if("request-otp"!==t.response.data.errors[0].detail){this.$super("handleLoginError",t);return}this.password=this.rememberOtpPassword,this.showOtpForm=!0}}}}}]);
//# sourceMappingURL=635.js.map