(()=>{"use strict";class e{static ucFirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}static lcFirst(e){return e.charAt(0).toLowerCase()+e.slice(1)}static toDashCase(e){return e.replace(/([A-Z])/g,"-$1").replace(/^-/,"").toLowerCase()}static toLowerCamelCase(t,r){let s=e.toUpperCamelCase(t,r);return e.lcFirst(s)}static toUpperCamelCase(t,r){return r?t.split(r).map(t=>e.ucFirst(t.toLowerCase())).join(""):e.ucFirst(t.toLowerCase())}static parsePrimitive(e){try{return/^\d+(.|,)\d+$/.test(e)&&(e=e.replace(",",".")),JSON.parse(e)}catch(t){return e.toString()}}}class t{static isNode(e){return"object"==typeof e&&null!==e&&(e===document||e===window||e instanceof Node)}static hasAttribute(e,r){if(!t.isNode(e))throw Error("The element must be a valid HTML Node!");return"function"==typeof e.hasAttribute&&e.hasAttribute(r)}static getAttribute(e,r){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!1===t.hasAttribute(e,r))throw Error('The required property "'.concat(r,'" does not exist!'));if("function"!=typeof e.getAttribute){if(s)throw Error("This node doesn't support the getAttribute function!");return}return e.getAttribute(r)}static getDataAttribute(r,s){let i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=s.replace(/^data(|-)/,""),n=e.toLowerCamelCase(o,"-");if(!t.isNode(r)){if(i)throw Error("The passed node is not a valid HTML Node!");return}if(void 0===r.dataset){if(i)throw Error("This node doesn't support the dataset attribute!");return}let a=r.dataset[n];if(void 0===a){if(i)throw Error('The required data attribute "'.concat(s,'" does not exist on ').concat(r,"!"));return a}return e.parsePrimitive(a)}static querySelector(e,r){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!t.isNode(e))throw Error("The parent node is not a valid HTML Node!");let i=e.querySelector(r)||!1;if(s&&!1===i)throw Error('The required element "'.concat(r,'" does not exist in parent node!'));return i}static querySelectorAll(e,r){let s=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(s&&!t.isNode(e))throw Error("The parent node is not a valid HTML Node!");let i=e.querySelectorAll(r);if(0===i.length&&(i=!1),s&&!1===i)throw Error('At least one item of "'.concat(r,'" must exist in parent node!'));return i}}class r{get(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"application/json",s=this._createPreparedRequest("GET",e,r);return this._sendRequest(s,null,t)}post(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let i=this._createPreparedRequest("POST",e,s);return this._sendRequest(i,t,r)}delete(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let i=this._createPreparedRequest("DELETE",e,s);return this._sendRequest(i,t,r)}patch(e,t,r){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"application/json";s=this._getContentType(t,s);let i=this._createPreparedRequest("PATCH",e,s);return this._sendRequest(i,t,r)}abort(){if(this._request)return this._request.abort()}_registerOnLoaded(e,t){t&&e.addEventListener("loadend",()=>{t(e.responseText,e)})}_sendRequest(e,t,r){return this._registerOnLoaded(e,r),e.send(t),e}_getContentType(e,t){return e instanceof FormData&&(t=!1),t}_createPreparedRequest(e,t,r){return this._request=new XMLHttpRequest,this._request.open(e,t),this._request.setRequestHeader("X-Requested-With","XMLHttpRequest"),r&&this._request.setRequestHeader("Content-type",r),this._request}constructor(){this._request=null}}class s{static iterate(e,t){if(e instanceof Map||Array.isArray(e))return e.forEach(t);if(e instanceof FormData){for(var r of e.entries())t(r[1],r[0]);return}if(e instanceof NodeList)return e.forEach(t);if(e instanceof HTMLCollection)return Array.from(e).forEach(t);if(e instanceof Object)return Object.keys(e).forEach(r=>{t(e[r],r)});throw Error("The element type ".concat(typeof e," is not iterable!"))}}let i="loader",o={BEFORE:"before",INNER:"inner"};class n{create(){if(!this.exists()){if(this.position===o.INNER){this.parent.innerHTML=n.getTemplate();return}this.parent.insertAdjacentHTML(this._getPosition(),n.getTemplate())}}remove(){let e=this.parent.querySelectorAll(".".concat(i));s.iterate(e,e=>e.remove())}exists(){return this.parent.querySelectorAll(".".concat(i)).length>0}_getPosition(){return this.position===o.BEFORE?"afterbegin":"beforeend"}static getTemplate(){return'<div class="'.concat(i,'" role="status">\n                    <span class="').concat("visually-hidden",'">Loading...</span>\n                </div>')}static SELECTOR_CLASS(){return i}constructor(e,t=o.BEFORE){this.parent=e instanceof Element?e:document.body.querySelector(e),this.position=t}}let a="element-loader-backdrop";class c extends n{static create(e){e.classList.add("has-element-loader"),c.exists(e)||(c.appendLoader(e),setTimeout(()=>{let t=e.querySelector(".".concat(a));t&&t.classList.add("element-loader-backdrop-open")},1))}static remove(e){e.classList.remove("has-element-loader");let t=e.querySelector(".".concat(a));t&&t.remove()}static exists(e){return e.querySelectorAll(".".concat(a)).length>0}static getTemplate(){return'\n        <div class="'.concat(a,'">\n            <div class="loader" role="status">\n                <span class="').concat("visually-hidden",'">Loading...</span>\n            </div>\n        </div>\n        ')}static appendLoader(e){e.insertAdjacentHTML("beforeend",c.getTemplate())}}class l extends window.PluginBaseClass{init(){this._httpClient=new r,this._submitButton=t.querySelector(this.el,this.options.buttonSelector),this._codeInput=t.querySelector(this.el,this.options.codeInputSelector),this._secretInput=t.querySelector(this.el,this.options.secretInputSelector),this._csrfInput=t.querySelector(this.el,this.options.csrfInputSelector),this._errorMessageWrapper=t.querySelector(this.el,this.options.errorMessageWrapperSelector),this._errorMessage=t.querySelector(this.el,this.options.errorMessageSelector),this.initListeners()}initListeners(){this._submitButton.addEventListener("click",this.onSubmitButtonClick.bind(this))}onSubmitButtonClick(){c.create(this.el),this._errorMessageWrapper.classList.add(this.options.invisibleClass),this._httpClient.post(this.options.verificationUrl,JSON.stringify({code:this._codeInput.value,secret:this._secretInput.value,_csrf_token:this._csrfInput.value}),e=>{let t=JSON.parse(e);if("OK"===t.status){window.location.reload();return}c.remove(this.el),this.showErrorMessage(t.error?t.error:"Something went wrong!")})}showErrorMessage(e){this._errorMessageWrapper.classList.remove(this.options.invisibleClass),this._errorMessage.innerHTML=e}}l.options={buttonSelector:".account-profile-2fa-setup-verify",codeInputSelector:"[name=otpVerification]",secretInputSelector:"[name=otpSecret]",csrfInputSelector:"[name=_csrf_token]",errorMessageWrapperSelector:".rl2fa-setup-verification-message",errorMessageSelector:".rl2fa-setup-verification-message .alert-content",invisibleClass:"d-none",verificationUrl:""},window.PluginManager.register("Rl2faVerificationPlugin",l,"[data-rl2fa-verification-plugin]")})();